

   <app-filter-form #newFilters ></app-filter-form> 
   <div class="wrapper">


   <table mat-table #table [dataSource]="orders" matSort class="mat-elevation-z8">

         <ng-container matColumnDef="id" >
           <th mat-header-cell *matHeaderCellDef mat-sort-header (click)="paginate('id')"  >Id</th>
           <td mat-cell   *matCellDef="let order; row"  
             ><a [routerLink]="[ '/order-detail', order.id ]"><mat-icon matTooltip="View Full Details">pageview</mat-icon></a>{{order.id}}</td>
           <td mat-footer-cell *matFooterCellDef  ></td>
         </ng-container>

         <ng-container matColumnDef="due_date" >
           <th mat-header-cell *matHeaderCellDef mat-sort-header (click)='paginate("due_date")' >Due Date</th>
           <td mat-cell   *matCellDef="let order; row"  >
              {{order.due_date | date:'MM/dd/yyyy'}}
       <!--<app-time-difference (reached)="callback($event)" units="Month | Days | Hours | Minutes"  end={{order.due_date}}></app-time-difference>-->
             </td>
           <td mat-footer-cell *matFooterCellDef></td>
         </ng-container>

         <ng-container matColumnDef="buyer_name" >
           <th mat-header-cell *matHeaderCellDef  mat-sort-header  (click)='paginate("buyer__name")' >Buyer</th>
           <td mat-cell   *matCellDef="let order; row"   id="updates">{{order.buyer_name}}</td>
           <td mat-footer-cell *matFooterCellDef></td>
         </ng-container>

         <ng-container matColumnDef="factory_name" >
           <th mat-header-cell *matHeaderCellDef  mat-sort-header (click)='paginate("factory__name")'>Factory</th>
           <td mat-cell   *matCellDef="let order; row"  >{{order.factory_name}}</td>
           <td mat-footer-cell *matFooterCellDef></td>
         </ng-container>

         <ng-container matColumnDef="order_type" >
             <th mat-header-cell *matHeaderCellDef  mat-sort-header (click)='paginate("order_type")'  >Order Type</th>
             <td mat-cell   *matCellDef="let order; row"  >{{order.order_type}}</td>
             <td mat-footer-cell *matFooterCellDef >P&L</td>
           </ng-container>


         <ng-container matColumnDef="buyer_style_number" >
           <th mat-header-cell *matHeaderCellDef mat-sort-header (click)='paginate("buyer_style_number")' >Buyer Style #</th>
           <td mat-cell   *matCellDef="let order; row"   >{{order.buyer_style_number}}</td>
           <td mat-footer-cell *matFooterCellDef></td>
         </ng-container>

         <ng-container matColumnDef="jp_style_number" >
           <th mat-header-cell *matHeaderCellDef mat-sort-header (click)='paginate("jp_style_number")'>JP Style #</th>
           <td mat-cell   *matCellDef="let order; row"   >{{order.jp_style_number}}</td>
           <td mat-footer-cell *matFooterCellDef [ngClass]="{'aligne-right': true}"></td>
         </ng-container>

         <ng-container matColumnDef="factory_ship_date" >
           <th mat-header-cell *matHeaderCellDef mat-sort-header (click)='paginate("factory_ship_date")' >Factory Ship Date</th>
           <td mat-cell   *matCellDef="let order; row"   >{{order.factory_ship_date | date:'MM/dd/yyyy' }}</td>
           <td mat-footer-cell *matFooterCellDef><span  style="font-size:xx-small">JP Cost: {{totalCost.jpCost | currency}}</span></td>
         </ng-container>

         <ng-container matColumnDef="cost_from_factory" >
           <th mat-header-cell *matHeaderCellDef mat-sort-header (click)='paginate("cost_from_factory")'  >Cost From Factory</th>
           <td mat-cell   *matCellDef="let order; row"   >{{order.cost_from_factory | currency}}</td>
           <td mat-footer-cell *matFooterCellDef ></td>
         </ng-container>

         <ng-container matColumnDef="buyers_price" >
           <th mat-header-cell *matHeaderCellDef mat-sort-header (click)='paginate("buyers_price")' >Price Buyer Paid</th>
           <td mat-cell   *matCellDef="let order; row"   >{{order.buyers_price | currency}}</td>
           <td mat-footer-cell *matFooterCellDef><span style="font-size:xx-small">Customers Paid: {{totalCost.buyerCost | currency}}</span></td>
         </ng-container>

          

         <ng-container matColumnDef="qty" >
           <th mat-header-cell *matHeaderCellDef mat-sort-header (click)='paginate("qty")' >Quantity</th>
           <td mat-cell   *matCellDef="let order; row"   >{{order.qty}}</td>
           <td mat-footer-cell *matFooterCellDef style="font-size:xx-small" >P&L Before Expense: {{totalCost.simpleProfit | currency}}</td>
         </ng-container>
         <ng-container matColumnDef="total_expense" >
             <th mat-header-cell *matHeaderCellDef >Agg. Exp. Cost</th>
             <td mat-cell   *matCellDef="let order; row"   >
                <span *ngFor="let expense of order.orderExpense">{{expense.totalExpense | currency}}</span>
               </td>
             <td mat-footer-cell *matFooterCellDef style="font-style: xx-small "></td>
           </ng-container>
          
            

         <ng-container matColumnDef="sweater_image" >
           <th mat-header-cell *matHeaderCellDef >Image</th>
           <td mat-cell   *matCellDef="let order; row">
            <img src='{{order.sweater_image}}'>
              
          </td>
           <td mat-footer-cell *matFooterCellDef></td>
         </ng-container>

         <ng-container matColumnDef="brand" >
           <th mat-header-cell *matHeaderCellDef mat-sort-header (click)='paginate("brand")' >Brand</th>
           <td mat-cell   *matCellDef="let order; row"   >{{order.brand}}</td>
           <td mat-footer-cell *matFooterCellDef></td>
         </ng-container>

         <ng-container matColumnDef="sweater_description" >
           <th mat-header-cell *matHeaderCellDef >Description</th>
           <td mat-cell  *matCellDef="let order; row"   >{{order.sweater_description}}</td>
           <td mat-footer-cell *matFooterCellDef></td>
         </ng-container>


         <ng-container matColumnDef="fiber_content" >
           <th mat-header-cell *matHeaderCellDef >Fiber Content </th>
           <td mat-cell *matCellDef="let order; row"   >{{order.fiber_content}}</td>
           <td mat-footer-cell *matFooterCellDef></td>
         </ng-container>

         <ng-container matColumnDef="color" >
           <th mat-header-cell *matHeaderCellDef >Color</th>
           <td mat-cell *matCellDef="let order; row"    >{{order.color}}</td>
           <td mat-footer-cell *matFooterCellDef></td>
         </ng-container>

         <ng-container matColumnDef="update" > 
           <th mat-header-cell *matHeaderCellDef >Update Order</th>
           <td mat-cell   *matCellDef="let order; row"   >
             <button mat-icon-button (click)="openUpdateDialog(order)"><mat-icon matTooltip="Update Order">update</mat-icon></button>
             <button mat-icon-button (click)="openDeleteDialog(order)"><mat-icon matTooltip="Delete Order">delete</mat-icon></button>

             </td>
           <td mat-footer-cell *matFooterCellDef ></td>
         </ng-container>
         <ng-container matColumnDef="tasks">
           <th mat-header-cell *matHeaderCellDef >Tasks</th>
            <td mat-cell   *matCellDef="let order; row" >
              <button mat-icon-button (click)="openAddTask(order)"><mat-icon matTooltip="Add Tasks">add</mat-icon></button>
              <button mat-icon-button (click)="openUpdateTask(order)" [disabled]="order.tasks.length === 0">
                 <span  matBadge={{order.completeTasks.length}} matBadgeSize="small"  matBadgeColor="#CBE9CB" matBadgePosition="above before"></span>
                     <mat-icon matBadge={{order.incompleteTasks.length}}
                       matBadgeSize="small"  matBadgeColor="warn" matTooltip="Update Tasks" >
                        update
                     </mat-icon>
                   </button>
           </td>
           <td mat-footer-cell *matFooterCellDef ></td>
         </ng-container>
         <ng-container matColumnDef="expenses">
             <th mat-header-cell *matHeaderCellDef >Expense</th>
             <td mat-cell    *matCellDef="let order; row"   >
                     <button mat-icon-button (click)="openAddExpenseDialog(order)">
                         <mat-icon matBadgeSize="small"  matBadgeColor="warn" matTooltip="Add Order Expense">
                            attach_money
                         </mat-icon>
                       </button>
             </td>
             <td mat-footer-cell *matFooterCellDef></td>
           </ng-container>



            
     <tr mat-header-row *matHeaderRowDef="displayColumns"></tr>
     <tr mat-row *matRowDef="let row;
                          let even = even;
                          columns: displayColumns;" 
     (click)="onRowClicked(row)" (click)="onRowHighlight(row)"
      [ngClass]="{'gray': even, 'highlight': selectedRowIndex == row.id}" color="primary" ></tr>
     <tr mat-footer-row *matFooterRowDef="displayColumns"></tr>


   </table>
  </div>

   <mat-paginator class="marginless-paginator-range-label" #paginator
    [length]=length
    [pageSize]=pageSize
    [pageSizeOptions]='pageSizeOptions'
    showFirstLastButtons='false'
    (page)="paginate()"
    class="mat-elevation-z8"
    ></mat-paginator>
<!--
  <div fxLayout="row" fxLayoutAlign="center center" fxLayoutGap="50px" style='padding-top: 20px'>
      

         <ng-container *ngIf='order && order.tasks.length >0'>
             <span *ngFor="let tasks of order.tasks">
                 <app-order-cards [tasks]='tasks' [avatar]='order.sweater_image'></app-order-cards>
             </span>
         </ng-container>

   </div>-->