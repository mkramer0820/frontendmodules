
<mat-accordion class="primary">
  <mat-expansion-panel (opened)="panelOpenState = true"
                       (closed)="panelOpenState = false">
    <mat-expansion-panel-header>
      <mat-panel-title>
        Filters
      </mat-panel-title>
      <mat-panel-description>
        <button mat-button color="accent" style="background-color: black" (click)="openAddDialog()">Add New Order</button> 
      </mat-panel-description>
    </mat-expansion-panel-header>
    
    <table>
      <tr>
        <td><input matInput #buyerStyle maxlength="35" placeholder="Enter some input" style="border-bottom: .1px solid rgb(70, 66, 66)"></td>
          
        <td><input matInput #jpStyle maxlength="35" placeholder="Enter some input" style="border-bottom: .1px solid rgb(70, 66, 66)"></td>
        <td><mat-form-field >
          <mat-select [(value)]="selected" placeholder="Select A Customer">
            <mat-option value=''>None</mat-option>
            <mat-option *ngFor="let customer of uniqueCustomerFilter" value={{customer}}>{{customer}}</mat-option>
          </mat-select>
          </mat-form-field></td>
        <!--td><app-date-picker placeholder="Select Start Date" [(ngModel)]="firstDate" format="YYYY-MM-DD"></app-date-picker></td>
        <td><app-date-picker placeholder="Select End Date" [(ngModel)]="secondDate" format="YYYY-MM-DD"></app-date-picker>  </td> 
        <td><button  mat-icon-button (click)="testOrderService(selected, firstDate, secondDate, '-id', buyerStyle.value ,jpStyle.value)">
          <mat-icon>refresh</mat-icon></button> -->
        <td><button  mat-icon-button (click)="testOrderService()"> {{orderSort}}
            <mat-icon>clear</mat-icon></button>
          </td>   
 
  </tr>
</table>  
  </mat-expansion-panel>
</mat-accordion>

  <mat-table id="orderTable" class="primary" [dataSource]="orders" matSort class="mat-elevation-z8">


        <ng-container matColumnDef="ID" fxFlex="60px" style="padding:0;">
          <!--<mat-header-cell *matHeaderCellDef mat-sort-header (click)="getSortOrders('id')" fxFlex="45px"> ID </mat-header-cell>-->
          <mat-header-cell *matHeaderCellDef mat-sort-header (click)="testOrderService('','','','id','','')" fxFlex="60px"> ID </mat-header-cell>
          <mat-cell mat-cell style="font-size: smaller"  *matCellDef="let order; row"  
          [ngClass]="{'highlight': selectedRowIndex == order.id}" fxFlex="60px"> {{order.id}} <mat-icon (click)="openDetailDialog(order)">pageview</mat-icon></mat-cell>
          <mat-footer-cell *matFooterCellDef fxFlex="45px"></mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="DUE DATE">
          <mat-header-cell *matHeaderCellDef mat-sort-header (click)="getSortOrders('due_date')">Due Date</mat-header-cell>
          <mat-cell mat-cell style="font-size: smaller"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"   style="font-size:smaller ">
            {{order.due_date | date:'MM/dd/yyyy'}}
       <!-- <app-time-difference (reached)="callback($event)" units="Month | Days | Hours | Minutes"  end={{order.due_date}}></app-time-difference> -->
            </mat-cell>
          <mat-footer-cell *matFooterCellDef></mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="BUYER" >
          <mat-header-cell *matHeaderCellDef  mat-sort-header (click)="getSortOrders('buyer__name')" > BUYER </mat-header-cell>
          <mat-cell mat-cell style="font-size: smaller"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > {{order.buyer_name}} </mat-cell>
          <mat-footer-cell *matFooterCellDef></mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="FACTORY" class="overflow">
          <mat-header-cell *matHeaderCellDef > FACTORY </mat-header-cell>
          <mat-cell mat-cell style="font-size: smaller"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > {{order.factory_name}} </mat-cell>
          <mat-footer-cell *matFooterCellDef></mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="ORDER NUMBER">
          <mat-header-cell *matHeaderCellDef > CUSTOMER ORDER ID </mat-header-cell>
          <mat-cell mat-cell style="font-size: smaller"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > {{order.customer_order_number}} </mat-cell>
          <mat-footer-cell *matFooterCellDef></mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="BUYER STYLE #">
          <mat-header-cell *matHeaderCellDef mat-sort-header (click)="testOrderService('','','','buyer_style_number','','')" > BUYER STYLE # </mat-header-cell>
          <mat-cell mat-cell style="font-size: smaller"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > {{order.buyer_style_number}} </mat-cell>
          <mat-footer-cell *matFooterCellDef></mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="JP STYLE #">
          <mat-header-cell *matHeaderCellDef mat-sort-header (click)="testOrderService('','','','jp_style_number','','')"> JP STYLE # </mat-header-cell>
          <mat-cell mat-cell style="font-size: smaller"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > {{order.jp_style_number}} </mat-cell>
          <mat-footer-cell *matFooterCellDef [ngClass]="{'aligne-right': true}">JP Cost:</mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="FACTORY SHIP DT">
          <mat-header-cell *matHeaderCellDef mat-sort-header (click)="testOrderService('','','','factory_ship_date','','')"> Factory Ship Date </mat-header-cell>
          <mat-cell mat-cell style="font-size: smaller"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > {{order.factory_ship_date | date:'MM/dd/yyyy' }} </mat-cell>
          <mat-footer-cell *matFooterCellDef style="font-size:xx-small "> {{totalCost.jpCost | currency}}</mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="COST FROM FACTORY">
          <mat-header-cell *matHeaderCellDef mat-sort-header (click)="testOrderService('','','','cost_from_factory','','')" > Cost From Factory </mat-header-cell>
          <mat-cell mat-cell style="font-size: smaller"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > {{order.cost_from_factory}} </mat-cell>
          <mat-footer-cell *matFooterCellDef style="font-size:smaller ">Customers Paid: </mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="BUYER PRICE">
          <mat-header-cell *matHeaderCellDef mat-sort-header (click)="testOrderService('','','','buyers_price','','')" > Price Buyer Paid </mat-header-cell>
          <mat-cell mat-cell style="font-size: smaller"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > {{order.buyers_price}} </mat-cell>
          <mat-footer-cell *matFooterCellDef>  <span style="font-size:xx-small">{{totalCost.buyerCost | currency}}</span> </mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="ORDER TYPE">
          <mat-header-cell *matHeaderCellDef > Order Type </mat-header-cell>
          <mat-cell mat-cell style="font-size: smaller"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > {{order.order_type}} </mat-cell>
          <mat-footer-cell *matFooterCellDef>P&L</mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="QTY">
          <mat-header-cell *matHeaderCellDef > Quantity </mat-header-cell>
          <mat-cell mat-cell style="font-size: smaller"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > {{order.qty}} </mat-cell>
          <mat-footer-cell *matFooterCellDef style="font-style: xx-small ">{{totalCost.simpleProfit | currency}}</mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="SWEATER IMG">
          <mat-header-cell *matHeaderCellDef > Image </mat-header-cell>
          <mat-cell mat-cell style="font-size: smaller"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  ><img src='{{order.sweater_image}}' /> </mat-cell>
          <mat-footer-cell *matFooterCellDef></mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="BRAND">
          <mat-header-cell *matHeaderCellDef mat-sort-header (click)="testOrderService('','','','brand','','')"> Brand </mat-header-cell>
          <mat-cell mat-cell style="font-size: smaller"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > {{order.brand}} </mat-cell>
          <mat-footer-cell *matFooterCellDef></mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="SWEATER DESCRIPTION" class="overflow">
          <mat-header-cell *matHeaderCellDef > DESCRIPTION </mat-header-cell>
          <mat-cell mat-cell style="font-size: xx-small"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > {{order.sweater_description}} </mat-cell>
          <mat-footer-cell *matFooterCellDef></mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="FIBER CONTENT" class="overflow">
          <mat-header-cell *matHeaderCellDef > Fiber Content </mat-header-cell>
          <mat-cell mat-cell style="font-size:x-small"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > {{order.fiber_content}} </mat-cell>
          <mat-footer-cell *matFooterCellDef></mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="COLOR">
          <mat-header-cell *matHeaderCellDef > Color </mat-header-cell>
          <mat-cell mat-cell style="font-size: xx-small"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"   > {{order.color}} </mat-cell>
          <mat-footer-cell *matFooterCellDef></mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="UPDATE">
          <mat-header-cell *matHeaderCellDef > Update </mat-header-cell>
          <mat-cell mat-cell style="font-size: smaller"   *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  >
             <button mat-mini-fab (click)="openUpdateDialog(order)"><mat-icon color="primary">update</mat-icon></button>
            </mat-cell>
          <mat-footer-cell *matFooterCellDef></mat-footer-cell>
        </ng-container>

        <ng-container matColumnDef="TASKS">
          <mat-header-cell *matHeaderCellDef >Add Update Tasks </mat-header-cell>
          <div>
          <mat-cell mat-cell style="font-size: smaller"   *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  >
                  <button mat-icon-button (click)="openAddTask(order)"><mat-icon>add</mat-icon></button>
                  <button mat-icon-button (click)="openUpdateTask(order)" [disabled]="order.tasks.length === 0">
                    <mat-icon matBadge='{{order.tasks.length}}' matBadgeSize="small"  matBadgeColor="warn" >
                      update
                    </mat-icon>
                  </button>
          </mat-cell>
          </div>
          <mat-footer-cell *matFooterCellDef></mat-footer-cell>
        </ng-container>
    <mat-header-row *matHeaderRowDef="displayColumns" ></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayColumns;" (click)="onRowClicked(row)" (click)="onRowHighlight(row)"  ></mat-row>
    <mat-footer-row *matFooterRowDef="displayColumns"></mat-footer-row>


  </mat-table>
<mat-card *ngIf="cred">
  {{cred | json}}
</mat-card>

<ng-container *ngIf='cards'>
  <div *ngIf='order && order.tasks.length > 0'>
    <div class='outer' fxLayout="row" fxLayoutGap="20px" >
      <mat-card class="example-card" fxFlex="25%" *ngFor="let task of order.tasks" fxLayoutGap="20px">
          <mat-card-header>
              <mat-card-title>{{task.todos_group}} </mat-card-title>
              <mat-card-subtitle>{{task.set_name}}</mat-card-subtitle>
              <mat-card-subtitle
               [ngClass]="{'Complete' : task.set_status === 'Complete',
                'Not-Complete' : task.set_status === 'Started', 'NA': task.status === 'NA'}">Status: {{task.set_status}}</mat-card-subtitle>
            <div mat-card-avatar class="example-header-image"><img src='{{order.sweater_image}}'></div>
          </mat-card-header>
          <mat-card-content *ngFor="let todo of task.todos">
            <div class="inner">
              <ol>
            <li >Task Type {{todo.todo}} -- Status: {{todo.status}}</li >
            <li #time ><app-time-difference (reached)="callback($event)" units="Month | Days | Hours | Minutes"  end={{todo.duedate}}></app-time-difference><li>
            <li >Comment: {{todo.comment}}</li >
              </ol>
           </div>
          </mat-card-content>
      </mat-card>
    </div>
  </div>
</ng-container>>

<!--
<modal id="task-modal">
  <div class="modal">
    <div class="modal-body">
      <app-order-task [order]="order"></app-order-task>
      <button (click)="closeModal('task-modal');">Close</button>
    </div>
  </div>
<div class="modal-background"></div>
</modal>

<modal id="update-task-modal">
    <div class="modal">
      <div class="modal-body">
        <app-order-task [order]="order" [update]="true"></app-order-task>
        <button (click)="closeModal('custom-modal-1');">Close</button>
      </div>
    </div>
  <div class="modal-background"></div>
  </modal>
-->