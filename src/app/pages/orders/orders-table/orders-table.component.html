   
   <div>

    <button mat-button color="accent" style="background-color: #424242;  color: CF6C29" (click)="openAddDialog()" >Add New Order</button> 

   <mat-accordion class="primary">
      <mat-expansion-panel (opened)="panelOpenState = true"
                          (closed)="panelOpenState = false">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Filters
          </mat-panel-title>
      
          <mat-panel-description>
          </mat-panel-description>
        </mat-expansion-panel-header>
          <app-filter-form #newFilters  ></app-filter-form>

      </mat-expansion-panel>
    </mat-accordion>
    <mat-table id="orderTable" class="primary" [dataSource]="orders" matSort class="mat-elevation-z8">
1

          <ng-container matColumnDef="ID" style="padding:0;">
            <mat-header-cell *matHeaderCellDef mat-sort-header (click)='sortTable("id")' fxFlex="90px"> <p>Id</p> </mat-header-cell>
            <mat-cell mat-cell   *matCellDef="let order; row"  
            [ngClass]="{'highlight': selectedRowIndex == order.id}" fxFlex="90px"> <p>{{order.id}}</p> <mat-icon (click)="openDetailDialog(order)">pageview</mat-icon></mat-cell>
            <mat-footer-cell *matFooterCellDef fxFlex="90px"></mat-footer-cell>
          </ng-container>

          <ng-container matColumnDef="DUE DATE">
            <mat-header-cell *matHeaderCellDef mat-sort-header (click)='sortTable("due_date")' ><p>Due Date</p></mat-header-cell>
            <mat-cell mat-cell   *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}" >
              <p>{{order.due_date | date:'MM/dd/yyyy'}}</p>
        <!-- <app-time-difference (reached)="callback($event)" units="Month | Days | Hours | Minutes"  end=<p>{{order.due_date}}</p>></app-time-difference> -->
              </mat-cell>
            <mat-footer-cell *matFooterCellDef></mat-footer-cell>
          </ng-container>

          <ng-container matColumnDef="BUYER" >
            <mat-header-cell *matHeaderCellDef  mat-sort-header  (click)='sortTable("buyer__name")' ><p> Buyer</p> </mat-header-cell>
            <mat-cell mat-cell   *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  id="updates"> <p>{{order.buyer_name}}</p> </mat-cell>
            <mat-footer-cell *matFooterCellDef></mat-footer-cell>
          </ng-container>

          <ng-container matColumnDef="FACTORY" class="overflow">
            <mat-header-cell *matHeaderCellDef  mat-sort-header (click)='sortTable("factory__name")' class="overflow"> <p>Factory</p> </mat-header-cell>
            <mat-cell mat-cell   *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}" ><p class="overflow" >{{order.factory_name}}</p> </mat-cell>
            <mat-footer-cell *matFooterCellDef></mat-footer-cell>
          </ng-container>

          <ng-container matColumnDef="ORDER TYPE">
              <mat-header-cell *matHeaderCellDef  mat-sort-header (click)='sortTable("order_type")'> <p>Order Type</p> </mat-header-cell>
              <mat-cell mat-cell   *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > <p>{{order.order_type}}</p> </mat-cell>
              <mat-footer-cell *matFooterCellDef>P&L</mat-footer-cell>
            </ng-container>


          <ng-container matColumnDef="BUYER STYLE #">
            <mat-header-cell *matHeaderCellDef mat-sort-header (click)='sortTable("buyer_style_number")' > <p>Buyer Style #</p></mat-header-cell>
            <mat-cell mat-cell   *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > <p>{{order.buyer_style_number}}</p> </mat-cell>
            <mat-footer-cell *matFooterCellDef></mat-footer-cell>
          </ng-container>

          <ng-container matColumnDef="JP STYLE #">
            <mat-header-cell *matHeaderCellDef mat-sort-header (click)='sortTable("jp_style_number")'><p> JP Style #</p> </mat-header-cell>
            <mat-cell mat-cell   *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > <p>{{order.jp_style_number}}</p> </mat-cell>
            <mat-footer-cell *matFooterCellDef [ngClass]="{'aligne-right': true}"></mat-footer-cell>
          </ng-container>

          <ng-container matColumnDef="FACTORY SHIP DT">
            <mat-header-cell *matHeaderCellDef mat-sort-header (click)='sortTable("factory_ship_date")' > <p>Factory Ship Date</p> </mat-header-cell>
            <mat-cell mat-cell   *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > <p>{{order.factory_ship_date | date:'MM/dd/yyyy' }}</p> </mat-cell>
            <mat-footer-cell *matFooterCellDef> <span  style="font-size:xx-small">JP Cost: <p>{{totalCost.jpCost | currency}}</p></span></mat-footer-cell>
          </ng-container>

          <ng-container matColumnDef="COST FROM FACTORY">
            <mat-header-cell *matHeaderCellDef mat-sort-header (click)='sortTable("cost_from_factory")' > <p>Cost From Factory</p> </mat-header-cell>
            <mat-cell mat-cell   *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  id="updates"> <p>{{order.cost_from_factory}}</p> </mat-cell>
            <mat-footer-cell *matFooterCellDef > </mat-footer-cell>
          </ng-container>

          <ng-container matColumnDef="BUYER PRICE">
            <mat-header-cell *matHeaderCellDef mat-sort-header (click)='sortTable("buyers_price")' > <p>Price Buyer Paid </p></mat-header-cell>
            <mat-cell mat-cell   *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > <p>{{order.buyers_price}}</p> </mat-cell>
            <mat-footer-cell *matFooterCellDef>  <span style="font-size:xx-small">Customers Paid: <p>{{totalCost.buyerCost | currency}}</p></span> </mat-footer-cell>
          </ng-container>

          

          <ng-container matColumnDef="QTY">
            <mat-header-cell *matHeaderCellDef mat-sort-header (click)='sortTable("qty")' > <p>Quantity</p> </mat-header-cell>
            <mat-cell mat-cell   *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > <p>{{order.qty}}</p> </mat-cell>
            <mat-footer-cell *matFooterCellDef style="font-size:xx-small">P&L Before Expense: <p>{{totalCost.simpleProfit | currency}}</p></mat-footer-cell>
          </ng-container>
          <ng-container matColumnDef="TOT. EXPENSE">
              <mat-header-cell *matHeaderCellDef ><p>Agg. Exp. Cost</p> </mat-header-cell>
              <mat-cell mat-cell   *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  >
                 <span *ngFor="let expense of order.orderExpense"><p>{{expense.totalExpense | currency}}</p></span>
                </mat-cell>
              <mat-footer-cell *matFooterCellDef style="font-style: xx-small "></mat-footer-cell>
            </ng-container>
          
            

          <ng-container matColumnDef="SWEATER IMG">
            <mat-header-cell *matHeaderCellDef > <p>Image </p></mat-header-cell>
            <mat-cell mat-cell   *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  ><img src='{{order.sweater_image}}' /> </mat-cell>
            <mat-footer-cell *matFooterCellDef></mat-footer-cell>
          </ng-container>

          <ng-container matColumnDef="BRAND">
            <mat-header-cell *matHeaderCellDef mat-sort-header (click)='sortTable("brand")'> <p>Brand</p> </mat-header-cell>
            <mat-cell mat-cell   *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > <p>{{order.brand}}</p> </mat-cell>
            <mat-footer-cell *matFooterCellDef></mat-footer-cell>
          </ng-container>

          <ng-container matColumnDef="SWEATER DESCRIPTION" class="overflow">
            <mat-header-cell *matHeaderCellDef ><p> Description </p></mat-header-cell>
            <mat-cell mat-cell  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > <p>{{order.sweater_description}}</p> </mat-cell>
            <mat-footer-cell *matFooterCellDef></mat-footer-cell>
          </ng-container>

          <ng-container matColumnDef="FIBER CONTENT" class="overflow">
            <mat-header-cell *matHeaderCellDef > <p>Fiber Content </p> </mat-header-cell>
            <mat-cell mat-cell *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  > <p>{{order.fiber_content}}</p> </mat-cell>
            <mat-footer-cell *matFooterCellDef></mat-footer-cell>
          </ng-container>

          <ng-container matColumnDef="COLOR">
            <mat-header-cell *matHeaderCellDef ><p> Color </p></mat-header-cell>
            <mat-cell mat-cell *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"   > <p>{{order.color}}</p> </mat-cell>
            <mat-footer-cell *matFooterCellDef></mat-footer-cell>
          </ng-container>

          <ng-container matColumnDef="UPDATE">
            <mat-header-cell *matHeaderCellDef ><p> Update Order </p></mat-header-cell>
            <mat-cell mat-cell  id="updates"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  >
              <button mat-icon-button (click)="openUpdateDialog(order)"><mat-icon >update</mat-icon></button>
              </mat-cell>
            <mat-footer-cell *matFooterCellDef></mat-footer-cell>
          </ng-container>

          <ng-container matColumnDef="TASKS">
            <mat-header-cell *matHeaderCellDef ><p>Add Update Tasks </p></mat-header-cell>
            <div>
            <mat-cell mat-cell  id="updates"  *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  >
                    <button mat-icon-button (click)="openAddTask(order)"><mat-icon>add</mat-icon></button>
                    <button mat-icon-button (click)="openUpdateTask(order)" [disabled]="order.tasks.length === 0">
                      <mat-icon matBadge={{order.tasks.length}} matBadgeSize="small"  matBadgeColor="warn" >
                        update
                      </mat-icon>
                    </button>
            </mat-cell>
            </div>
            <mat-footer-cell *matFooterCellDef></mat-footer-cell>
          </ng-container>

          <ng-container matColumnDef="EXPENSE">
              <mat-header-cell *matHeaderCellDef ><p>EXPENSES</p> </mat-header-cell>
              <mat-cell mat-cell id="updates"    *matCellDef="let order; row"  [ngClass]="{'highlight': selectedRowIndex == order.id}"  >
                      <button mat-icon-button (click)="openAddExpenseDialog(order)">
                          <mat-icon matBadgeSize="small"  matBadgeColor="warn" >
                            account_balance
                          </mat-icon>
                        </button>
              </mat-cell>
              <mat-footer-cell *matFooterCellDef></mat-footer-cell>
            </ng-container>



      <mat-header-row *matHeaderRowDef="displayColumns" ></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayColumns;" (click)="onRowClicked(row)" (click)="onRowHighlight(row)"  ></mat-row>
      <mat-footer-row *matFooterRowDef="displayColumns"></mat-footer-row>


    </mat-table>
    <div fxLayout="row" style="padding-bottom: 1em">

    </div>
  
    <div class="container">

      <div class="block" fxLayout='row' fxLayoutWrap fxLayoutGap="2rem">

          <ng-container *ngIf='order && order.tasks.length > 0'>
              <span *ngFor="let tasks of order.tasks">
                  <app-order-cards [tasks]='tasks' [avatar]='order.sweater_image'></app-order-cards>
              </span>
            </ng-container>

          </div>
      </div>
</div>
